{
  "version": 3,
  "sources": ["../../../../../Modules/Administration/User/UserPage.ts", "../../../../../Modules/Administration/User/UserGrid.ts", "../../../../../Modules/Administration/UserPermission/UserPermissionDialog.ts", "../../../../../Modules/Administration/User/UserDialog.ts"],
  "sourcesContent": ["import { initFullHeightGridPage } from \"@serenity-is/corelib/q\"\r\nimport { UserGrid } from \"./UserGrid\";\r\n\r\n$(function() {\r\n    initFullHeightGridPage(new UserGrid($('#GridDiv')).element);\r\n});", "import { Decorators, EntityGrid } from \"@serenity-is/corelib\";\r\nimport { resolveUrl, tryFirst } from \"@serenity-is/corelib/q\";\r\nimport { RoleRow, UserColumns, UserRow, UserService } from \"../\";\r\nimport { UserDialog } from \"./UserDialog\";\r\n\r\n@Decorators.registerClass()\r\nexport class UserGrid extends EntityGrid<UserRow, any> {\r\n    protected getColumnsKey() { return UserColumns.columnsKey; }\r\n    protected getDialogType() { return UserDialog; }\r\n    protected getIdProperty() { return UserRow.idProperty; }\r\n    protected getIsActiveProperty() { return UserRow.isActiveProperty; }\r\n    protected getLocalTextPrefix() { return UserRow.localTextPrefix; }\r\n    protected getService() { return UserService.baseUrl; }\r\n\r\n    constructor(container: JQuery) {\r\n        super(container);\r\n    }\r\n\r\n    protected getDefaultSortBy() {\r\n        return [UserRow.Fields.Username];\r\n    }\r\n\r\n    protected getColumns() {\r\n        var columns = super.getColumns();\r\n\r\n        var impersonate = tryFirst(columns, x => x.field == \"ImpersonationToken\");\r\n        if (impersonate != null) {\r\n            impersonate.format = ctx => {\r\n                if (!ctx.value)\r\n                    return \"\";\r\n\r\n                return `<a target=\"_blank\" href=\"${resolveUrl('~/Account/ImpersonateAs?token=')}${ctx.value}\">`\r\n                    + `<i class=\"fa fa-user-secret text-blue\"></i></a>`;\r\n            };\r\n        }\r\n\r\n        var roles = tryFirst(columns, x => x.field == UserRow.Fields.Roles);\r\n        if (roles) {\r\n            roles.format = ctx => {\r\n                var roleList = (ctx.value || []).map(x => (RoleRow.getLookup().itemById[x] || {}).RoleName || \"\");\r\n                roleList.sort();\r\n                return roleList.join(\", \");\r\n            };\r\n        }\r\n\r\n        return columns;\r\n    }\r\n}\r\n", "import { Decorators, TemplatedDialog } from \"@serenity-is/corelib\";\r\nimport { format, getRemoteData, notifySuccess, text } from \"@serenity-is/corelib/q\";\r\nimport { UserPermissionService } from \"../\";\r\nimport { PermissionCheckEditor } from \"./PermissionCheckEditor\";\r\n\r\n@Decorators.registerClass()\r\nexport class UserPermissionDialog extends TemplatedDialog<UserPermissionDialogOptions> {\r\n\r\n    private permissions: PermissionCheckEditor;\r\n\r\n    constructor(opt: UserPermissionDialogOptions) {\r\n        super(opt);\r\n\r\n        this.permissions = new PermissionCheckEditor(this.byId('Permissions'), {\r\n            showRevoke: true\r\n        });\r\n\r\n        UserPermissionService.List({\r\n            UserID: this.options.userID,\r\n            Module: null,\r\n            Submodule: null\r\n        }, response => {\r\n            this.permissions.value = response.Entities;\r\n        });\r\n\r\n        UserPermissionService.ListRolePermissions({\r\n            UserID: this.options.userID,\r\n            Module: null,\r\n            Submodule: null,\r\n        }, response => {\r\n            this.permissions.rolePermissions = response.Entities;\r\n        });\r\n\r\n        this.permissions.implicitPermissions = getRemoteData('Administration.ImplicitPermissions');\r\n        this.dialogTitle = format(text('Site.UserPermissionDialog.DialogTitle'),\r\n            this.options.username);\r\n    }\r\n\r\n    protected getDialogButtons() {\r\n        return [\r\n            {\r\n                text: text('Dialogs.OkButton'),\r\n                cssClass: 'btn btn-primary',\r\n                click: e => {\r\n                    UserPermissionService.Update({\r\n                        UserID: this.options.userID,\r\n                        Permissions: this.permissions.value,\r\n                        Module: null,\r\n                        Submodule: null\r\n                    }, response => {\r\n                        this.dialogClose();\r\n                        window.setTimeout(() => notifySuccess(text('Site.UserPermissionDialog.SaveSuccess')), 0);\r\n                    });\r\n                }\r\n            }, {\r\n                text: text('Dialogs.CancelButton'),\r\n                click: () => this.dialogClose()\r\n            }\r\n        ];\r\n    }\r\n\r\n    protected getTemplate(): string {\r\n        return '<div id=\"~_Permissions\"></div>';\r\n    }\r\n}\r\n\r\nexport interface UserPermissionDialogOptions {\r\n    userID?: number;\r\n    username?: string;\r\n}\r\n", "import { UserForm, UserRow, UserService } from \"../\";\r\nimport { UserPermissionDialog } from \"../UserPermission/UserPermissionDialog\";\r\nimport { Decorators, EntityDialog } from \"@serenity-is/corelib\"\r\nimport { text } from \"@serenity-is/corelib/q\";\r\n\r\n@Decorators.registerClass()\r\nexport class UserDialog extends EntityDialog<UserRow, any> {\r\n    protected getFormKey() { return UserForm.formKey; }\r\n    protected getIdProperty() { return UserRow.idProperty; }\r\n    protected getIsActiveProperty() { return UserRow.isActiveProperty; }\r\n    protected getLocalTextPrefix() { return UserRow.localTextPrefix; }\r\n    protected getNameProperty() { return UserRow.nameProperty; }\r\n    protected getService() { return UserService.baseUrl; }\r\n\r\n    protected form = new UserForm(this.idPrefix);\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.form.Password.addValidationRule(this.uniqueName, e => {\r\n            if (this.form.Password.value.length < 7)\r\n                return \"Password must be at least 7 characters!\";\r\n        });\r\n\r\n        this.form.PasswordConfirm.addValidationRule(this.uniqueName, e => {\r\n            if (this.form.Password.value != this.form.PasswordConfirm.value)\r\n                return \"The passwords entered doesn't match!\";\r\n        });\r\n    }\r\n\r\n    protected getToolbarButtons()\r\n    {\r\n        let buttons = super.getToolbarButtons();\r\n\r\n        buttons.push({\r\n            title: text('Site.UserDialog.EditPermissionsButton'),\r\n            cssClass: 'edit-permissions-button',\r\n            icon: 'fa-lock text-green',\r\n            onClick: () =>\r\n            {\r\n                new UserPermissionDialog({\r\n                    userID: this.entity.UserId,\r\n                    username: this.entity.Username\r\n                }).dialogOpen();\r\n            }\r\n        });\r\n\r\n        return buttons;\r\n    }\r\n\r\n    protected updateInterface() {\r\n        super.updateInterface();\r\n\r\n        this.toolbar.findButton(\"edit-permissions-button\").toggleClass(\"disabled\", this.isNewOrDeleted());\r\n    }\r\n\r\n    protected afterLoadEntity() {\r\n        super.afterLoadEntity();\r\n\r\n        // these fields are only required in new record mode\r\n        this.form.Password.element.toggleClass('required', this.isNew())\r\n            .closest('.field').find('sup').toggle(this.isNew());\r\n        this.form.PasswordConfirm.element.toggleClass('required', this.isNew())\r\n            .closest('.field').find('sup').toggle(this.isNew());\r\n    }\r\n\r\n    protected getPropertyItems() {\r\n        var items = super.getPropertyItems();\r\n        if (!Q.Authorization.hasPermission(\"Administration:Tenants\"))\r\n            items = items.filter(x => x.name != UserRow.Fields.TenantId);\r\n        return items;\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": ["import_q", "import_corelib", "import_q", "import_corelib", "import_q", "UserPermissionDialog", "opt", "PermissionCheckEditor", "UserPermissionService", "response", "__decorateClass", "import_corelib", "import_q", "UserDialog", "UserForm", "UserRow", "UserService", "buttons", "UserPermissionDialog", "items", "x", "__decorateClass", "UserGrid", "UserColumns", "UserDialog", "UserRow", "UserService", "container", "columns", "impersonate", "x", "ctx", "roles", "roleList", "RoleRow", "__decorateClass", "UserGrid"]
}
