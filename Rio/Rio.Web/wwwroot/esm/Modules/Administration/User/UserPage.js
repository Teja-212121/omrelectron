import{a as I}from"../../../_chunks/chunk-ROGRYPGM.js";import{a as n,b as l,c as d,e as y,l as x,o as C,p as v,q as c,r as e,s as f}from"../../../_chunks/chunk-T7ON5GPB.js";var U=n(d(),1);var P=n(y(),1),p=n(d(),1);var g=n(y(),1),t=n(d(),1);var a=class extends g.TemplatedDialog{constructor(r){super(r);this.permissions=new I(this.byId("Permissions"),{showRevoke:!0}),c.List({UserID:this.options.userID,Module:null,Submodule:null},i=>{this.permissions.value=i.Entities}),c.ListRolePermissions({UserID:this.options.userID,Module:null,Submodule:null},i=>{this.permissions.rolePermissions=i.Entities}),this.permissions.implicitPermissions=(0,t.getRemoteData)("Administration.ImplicitPermissions"),this.dialogTitle=(0,t.format)((0,t.text)("Site.UserPermissionDialog.DialogTitle"),this.options.username)}getDialogButtons(){return[{text:(0,t.text)("Dialogs.OkButton"),cssClass:"btn btn-primary",click:r=>{c.Update({UserID:this.options.userID,Permissions:this.permissions.value,Module:null,Submodule:null},i=>{this.dialogClose(),window.setTimeout(()=>(0,t.notifySuccess)((0,t.text)("Site.UserPermissionDialog.SaveSuccess")),0)})}},{text:(0,t.text)("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}getTemplate(){return'<div id="~_Permissions"></div>'}};a=l([g.Decorators.registerClass()],a);var h=n(y(),1),b=n(d(),1);var u=class extends h.EntityDialog{constructor(){super();this.form=new v(this.idPrefix);this.form.Password.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value.length<7)return"Password must be at least 7 characters!"}),this.form.PasswordConfirm.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value!=this.form.PasswordConfirm.value)return"The passwords entered doesn't match!"})}getFormKey(){return v.formKey}getIdProperty(){return e.idProperty}getIsActiveProperty(){return e.isActiveProperty}getLocalTextPrefix(){return e.localTextPrefix}getNameProperty(){return e.nameProperty}getService(){return f.baseUrl}getToolbarButtons(){let r=super.getToolbarButtons();return r.push({title:(0,b.text)("Site.UserDialog.EditPermissionsButton"),cssClass:"edit-permissions-button",icon:"fa-lock text-green",onClick:()=>{new a({userID:this.entity.UserId,username:this.entity.Username}).dialogOpen()}}),r}updateInterface(){super.updateInterface(),this.toolbar.findButton("edit-permissions-button").toggleClass("disabled",this.isNewOrDeleted())}afterLoadEntity(){super.afterLoadEntity(),this.form.Password.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew()),this.form.PasswordConfirm.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew())}};u=l([h.Decorators.registerClass()],u);var m=class extends P.EntityGrid{getColumnsKey(){return C.columnsKey}getDialogType(){return u}getIdProperty(){return e.idProperty}getIsActiveProperty(){return e.isActiveProperty}getLocalTextPrefix(){return e.localTextPrefix}getService(){return f.baseUrl}constructor(o){super(o)}getDefaultSortBy(){return[e.Fields.Username]}getColumns(){var o=super.getColumns(),r=(0,p.tryFirst)(o,s=>s.field=="ImpersonationToken");r!=null&&(r.format=s=>s.value?`<a target="_blank" href="${(0,p.resolveUrl)("~/Account/ImpersonateAs?token=")}${s.value}"><i class="fa fa-user-secret text-blue"></i></a>`:"");var i=(0,p.tryFirst)(o,s=>s.field==e.Fields.Roles);return i&&(i.format=s=>{var D=(s.value||[]).map(S=>(x.getLookup().itemById[S]||{}).RoleName||"");return D.sort(),D.join(", ")}),o}};m=l([P.Decorators.registerClass()],m);$(function(){(0,U.initFullHeightGridPage)(new m($("#GridDiv")).element)});
//# sourceMappingURL=UserPage.js.map
